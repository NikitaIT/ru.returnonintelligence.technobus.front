"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,o=Array(t.length);e<t.length;e++)o[e]=t[e];return o}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function setLanguage(t){$.getJSON("lang/"+t+".json",function(t){$.each(t,function(t,e){$("[name = "+t+"]").html(e)})})}var _slicedToArray=function(){function t(t,e){var o=[],n=!0,a=!1,s=void 0;try{for(var i,l=t[Symbol.iterator]();!(n=(i=l.next()).done)&&(o.push(i.value),!e||o.length!==e);n=!0);}catch(t){a=!0,s=t}finally{try{!n&&l.return&&l.return()}finally{if(a)throw s}}return o}return function(e,o){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return t(e,o);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),_createClass=function(){function t(t,e){for(var o=0;o<e.length;o++){var n=e[o];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,n.key,n)}}return function(e,o,n){return o&&t(e.prototype,o),n&&t(e,n),e}}();$(function(){var t=function(){function t(e,o){_classCallCheck(this,t),this.key=e,this.spreadsheetId=o}return _createClass(t,[{key:"load",value:function(t,e,o){var s="https://sheets.googleapis.com/v4/spreadsheets/"+a+"/values/"+t+"!"+e+"?key="+n;console.log("get:",s),$.getJSON(s,o)}}]),t}(),e=function(){function t(e,o){if(_classCallCheck(this,t),this.tableViewer=e,this.googleSpreadsheet=o,0==localStorage.length||null==localStorage.getItem(0)||null==localStorage.getItem(1))this.saveToLocalStorage(),console.log("first saveToLocalStorage()");else{console.log("first showTimetable()");try{this.showTimetable()}catch(t){console.error("showTimetable: ",t)}navigator.onLine&&(console.log("onLine updateStorage()"),this.updateStorage())}}return _createClass(t,[{key:"googleSpreadsheetLoad",value:function(t,e,o){this.googleSpreadsheet.load(t,e,function(t){console.log("Загружен обьект:",t),o(t)})}},{key:"saveToLocalStorage",value:function(){var t=this;this.googleSpreadsheetLoad("To Technopolis","A1:H100",function(e){console.log(e),localStorage.setItem(0,JSON.stringify(e)),t.tableViewer.addTableList(e,0)}),this.googleSpreadsheetLoad("From Technopolis","A1:H100",function(e){localStorage.setItem(1,JSON.stringify(e)),t.tableViewer.addTableList(e,1)}),this.googleSpreadsheetLoad("Объявления","A1:B10",function(e){t.tableViewer.addInfoList(e)}),localStorage.setItem("DATE",Date())}},{key:"updateStorage",value:function(){this.tableViewer.cleanTableList(),this.saveToLocalStorage()}},{key:"showTimetable",value:function(){this.tableViewer.addTableList(JSON.parse(localStorage.getItem(0)),0),this.tableViewer.addTableList(JSON.parse(localStorage.getItem(1)),1)}}]),t}(),o=function(){function t(e,o){_classCallCheck(this,t),this.timetableRowClass=e,this.infoClass=o}return _createClass(t,[{key:"addInfoList",value:function(t){console.log("f: addTableList(infoJSON=",t,", infoClass= "+this.infoClass+")");var e="";t.values.shift(),t.values.forEach(function(t){e+='<p class="info-list--elem">\n\t\t\t\t\t\t\t\t\t\t<span class="info-list--elem__title">\n\t\t\t\t\t\t\t\t\t\t\t'+t[0]+"\n\t\t\t\t\t\t\t\t\t\t</span>\n\t\t\t\t\t\t\t\t\t\t"+t[1]+"\n\t\t\t\t\t\t\t\t\t</p>"}),$(this.infoClass).append(e)}},{key:"addTableList",value:function(t,e){function o(t,e){return t.min>e.min?1:t.min<e.min?-1:void 0}console.log("f: addTableList(id="+e+", timetableJSON=",t,", timetableRowClass= "+this.timetableRowClass+")");var n='<div class="timetable__row__current" id="route'+e+'">',a=t.values,s={};a.shift(),a.forEach(function(t,e){var o=t[0].split(":"),n=_slicedToArray(o,2),a=n[0],i=n[1];t.shift(),void 0==s[a]&&(s[a]=[]),s[a].push({min:i,mins:t})});for(var i=0;i<s.length;i++)s[i]=s[i].sort(o);for(hour in s){var l=function(t,e){function o(t){for(var e="",o=[].concat(_toConsumableArray(days),["All"]),n=0,a=0;a<t.length;a++)""!=t[a]?e+=" day-"+o[a]:n++;return 0==n&&(e+=" day-All"),e}var n="";return e.forEach(function(e,a){n+='<div  class="timetable__min '+o(e.mins)+'">\n\t\t\t\t\t\t\t\t\t'+t+":"+e.min+"\n\t\t\t\t\t\t\t\t</div>"}),n}(hour,s[hour]);""!==l&&(n+='<div class="timetable__row">\n\t\t\t\t\t\t\t\t\t<div class="timetable__hover">\n\t\t\t\t\t\t\t\t\t\t'+hour+'\t\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t\t<hr class="line"/>\n\t\t\t\t\t\t\t\t\t<div class="timetable__row--subrow">\n\t\t\t\t\t\t\t\t\t\t'+l+"\n\t\t\t\t\t\t\t\t\t</div>\n\t\t\t\t\t\t\t\t</div>")}n+="</div>",$(this.timetableRowClass).append(n)}},{key:"cleanTableList",value:function(){$(this.timetableRowClass).html("")}},{key:"cleanInfoList",value:function(){$(this.infoClass).html("")}}]),t}(),n="AIzaSyC6gFH_bbSeMSIzEexKIUQ3MGE1MK2mBdo",a="1Xdje643qsnGXaOjU70larjh-UFTh6Bt9ii83a7t68Oo",s=new t(n,a),i=new o(".timetable__row__all",".info-list");new e(i,s);setLanguage("ru")}),$(function(){function t(){var t={hour:"numeric",minute:"numeric"},e=new Date;$(".day").attr("name",function(t){return fullDays[t.getDay()]}(e)),$("time.current-time").html(e.toLocaleString("ru",t)+" "),Number.prototype.div=function(t){return(this-this%t)/t};var o=e.getMinutes();o=o>=10?o.div(10)+1+"0":"10",$(".timetable__min:contains("+e.getHours()+":"+o+")").css("border","2px solid green")}t(),setInterval(t,9e3)}),$(function(){function t(){function t(t,e){ymaps.route([{point:t,type:"viaPoint"},e]).then(function(t){s.geoObjects.add(l=t)},function(t){console.error("Возникла ошибка: "+t.message)})}function e(){r.isSelected()&&(l&&s.geoObjects.remove(l),t(n,a))}var o={metro:[59.853876,30.321102],technopolis:[59.818043,30.327938],metro1:[59.850127,30.321772],routeCenter:[59.835681,30.322253]},n=o.metro,a=o.technopolis,s=new ymaps.Map("map",{center:o.metro,zoom:16},{searchControlProvider:"yandex#search"}),i=new ymaps.Placemark(s.getCenter());s.geoObjects.add(i);var l=void 0,r=new ymaps.control.Button('<i class="fa fa-bus" style="color: dimgray"></i>');r.events.add("select",function(){t(n,a),s.setZoom(12),s.setCenter(o.routeCenter)}).add("deselect",function(){l&&s.geoObjects.remove(l)}),s.controls.add(r,{float:"left",maxWidth:"auto"}),i.events.add("mouseenter",function(t){t.get("target").options.set("preset","islands#greenIcon")}).add("mouseleave",function(t){t.get("target").options.unset("preset")}),$(".from_technopolis").click(function(){s.setCenter(o.technopolis),i.geometry.setCoordinates(s.getCenter()),n=o.technopolis,a=o.metro1,e(),s.setZoom(16)}),$(".to_technopolis").click(function(){s.setCenter(o.metro),i.geometry.setCoordinates(s.getCenter()),n=o.metro,a=o.technopolis,e(),s.setZoom(16)})}ymaps.ready(t)}),$(function(){!function(){var t="";days.forEach(function(e,o){t+='<div class="panel--button panel--button-'+o+" day-"+e+'">\n\t\t\t\t\t\t<span name="'+e+'"></span>\n\t\t\t\t\t</div>'}),$(".panel").append(t),days.forEach(function(t){$(".panel--button.day-"+t).click(function(){console.log(t," clicked"),days.forEach(function(t){$(".timetable__min.day-"+t).removeClass("spy"),console.log(t," removeClass")}),$(".timetable__min.day-"+t).addClass("spy"),console.log(t," addClass"),setTimeout(function(){days.forEach(function(t){$(".timetable__min.day-"+t).removeClass("spy"),console.log(t," removeClass")})},3e3)})})}()}),$(function(){$(".preloader").delay(1e3).fadeOut("slow")}),$(".xls").click(function(){location.href="https://docs.google.com/spreadsheet/pub?key=1Xdje643qsnGXaOjU70larjh-UFTh6Bt9ii83a7t68Oo&output=xls"}),$(".pdf").click(function(){location.href="https://docs.google.com/spreadsheet/pub?key=1Xdje643qsnGXaOjU70larjh-UFTh6Bt9ii83a7t68Oo&output=pdf"}),$(function(){$(".russian").button("toggle"),$(".russian").click(function(){setLanguage("ru"),$("#map").attr("lang","ru")}),$(".russian").click(),$(".english").click(function(){setLanguage("en"),$("#map").attr("lang","en")}),$(".lang").addClass("btn-group-vertical"),$(".lang").removeClass("btn-group"),$(".to_technopolis").button("toggle"),$(".to_technopolis").click(function(){$("#route0").css("visibility","visible"),$("#route0").css("position","initial"),$("#route1").css("visibility","hidden"),$("#route1").css("position","absolute")}),$(".from_technopolis").click(function(){$("#route0").css("visibility","hidden"),$("#route0").css("position","absolute"),$("#route1").css("visibility","visible"),$("#route1").css("position","initial")})});var days=["monday","tuesday","tednesday","thursday","friday","saturday","sunday"],fullDays=["fullMonday","fullTuesday","fullTednesday","fullThursday","fullFriday","fullSaturday","fullSunday"];UpUp.start({"content-url":"index.html",assets:["/img/technopolis.jpg","/css/main.min.css","/lang/en.json","/lang/ru.json","/js/scripts.min.js"],"service-worker-url":"/upup.sw.min.js"});